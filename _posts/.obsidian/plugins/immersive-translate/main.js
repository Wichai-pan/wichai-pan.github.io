/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var w=Object.defineProperty;var R=Object.getOwnPropertyDescriptor;var C=Object.getOwnPropertyNames;var A=Object.prototype.hasOwnProperty;var E=(n,o)=>{for(var t in o)w(n,t,{get:o[t],enumerable:!0})},k=(n,o,t,e)=>{if(o&&typeof o=="object"||typeof o=="function")for(let i of C(o))!A.call(n,i)&&i!==t&&w(n,i,{get:()=>o[i],enumerable:!(e=R(o,i))||e.enumerable});return n};var O=n=>k(w({},"__esModule",{value:!0}),n);var N={};E(N,{default:()=>y});module.exports=O(N);var v=require("obsidian");var b=async()=>{let n="immersiveTranslate";Object.keys(window.localStorage).filter(s=>s.startsWith(n)).forEach(s=>{delete window.localStorage[s]});let t="immersive-translate";await window.indexedDB.databases().then(s=>{var p;(p=s==null?void 0:s.filter(a=>{var m;return(m=a.name)==null?void 0:m.startsWith(t)}))==null||p.forEach(a=>{a.name&&window.indexedDB.deleteDatabase(a.name)})}).catch(()=>{});let e="mmersiveTranslate";Object.keys(window).filter(s=>s.indexOf(e)!==-1).forEach(s=>{typeof window[s]!="undefined"&&delete window[s]})},T=()=>{let n=new KeyboardEvent("keydown",{key:"\xE5",keyCode:65,which:65,code:"KeyA",altKey:!0,bubbles:!0});document.dispatchEvent(n)},g=n=>Array.isArray(n)?`[${n.map(o=>`${JSON.stringify(o)}`)}]`:"[]";function x(n,o=500){let t;return(...e)=>{clearTimeout(t),t=window.setTimeout(()=>n(...e),o)}}var d=require("obsidian");var f={pageRule:{selectors:[".markdown-reading-view *"],excludeSelectors:[".markdown-reading-view .cm-inline-code"]}},S=class extends d.PluginSettingTab{constructor(t,e){super(t,e);this.plugin=e;this.component=new d.Component,this.compareKeys=["selectors","excludeSelectors"];let i=Object.fromEntries(this.compareKeys.map(s=>[s,this.plugin.settings[s]]));this.tempSettings=i,this.relaunchRef=void 0}getCompareStr(t){let{selectors:e,excludeSelectors:i}=t;return JSON.stringify({selectors:e,excludeSelectors:i})}compareSetting(){this.getCompareStr(this.plugin.settings)!==this.getCompareStr(this.tempSettings)&&this.relaunchRef?this.relaunchRef.clear().setName("Relaunch").setDesc("settings is changed, it need to relaunch").addButton(t=>{t.onClick(async()=>{this.compareKeys.forEach(e=>{this.plugin.settings[e]=this.tempSettings[e]}),await this.plugin.saveData(this.plugin.settings),window.location.reload()}),t.setButtonText("relaunch"),t.setClass("mod-cta")}):this.relaunchRef&&this.relaunchRef.clear().setName("").setDesc("")}display(){var r,l;let{containerEl:t}=this;this.component.load(),t.empty();let e=this.tempSettings,i=f.pageRule.selectors,s=g((r=this.plugin.settings)==null?void 0:r.selectors),p=x(async u=>{try{let c=JSON.parse(u);c.includes(i[0])||c.unshift(i[0]),e.selectors=c,this.compareSetting()}catch(c){}});new d.Setting(t).setName("Selectors").setDesc(`Array, default: ${g(i)}`).addText(u=>u.setValue(s).onChange(p));let a=f.pageRule.excludeSelectors,m=g((l=this.plugin.settings)==null?void 0:l.excludeSelectors),h=x(async u=>{try{let c=JSON.parse(u);c.includes(a[0])||c.unshift(a[0]),e.excludeSelectors=c,this.compareSetting()}catch(c){}});new d.Setting(t).setName("ExcludeSelectors").setDesc(`Array, default: ${g(a)}`).addText(u=>u.setValue(m).onChange(h)),this.relaunchRef=new d.Setting(t)}hide(){this.component.unload()}};var D="https://download.immersivetranslate.com/immersive-translate-sdk-latest.js",y=class extends v.Plugin{async onload(){if(await this.loadSettings(),this.settingTab=new S(this.app,this),this.addSettingTab(this.settingTab),!window.immersiveTranslateConfig){window.immersiveTranslateConfig={pageRule:JSON.parse(JSON.stringify(this.settings))};let t=document.createElement("script");t.classList.add("imt-script"),t.async=!0,t.src=D,t.onload=()=>{setTimeout(()=>{var i;let e=(i=document.querySelector("#immersive-translate-popup"))==null?void 0:i.shadowRoot;if(e){let s=e.querySelector(".imt-fb-container>div");s&&(s.style.display="none")}},1e3)},document.body.append(t)}}async onunload(){var m,h;let t=document.querySelector("#immersive-translate-popup"),e=document.querySelector("html");((m=e==null?void 0:e.getAttribute)==null?void 0:m.call(e,"imt-state"))==="dual"&&T();let s=document.querySelector(".imt-script"),p=[...document.querySelectorAll('[data-id*="immersive-translate"]')],a=[];[t,s,p].filter(r=>!!r).forEach(r=>Array.isArray(r)?r.forEach(l=>l&&a.push(l)):r&&a.push(r)),a.forEach(r=>{var l;return(l=r==null?void 0:r.remove)==null?void 0:l.call(r)}),(h=document.querySelectorAll("[data-immersive-translate-walked]"))==null||h.forEach(r=>r.removeAttribute("data-immersive-translate-walked")),e==null||e.removeAttribute("imt-state"),e==null||e.removeAttribute("imt-trans-position"),await b()}async loadSettings(){this.settings=Object.assign({},JSON.parse(JSON.stringify(f.pageRule)),await this.loadData())}};

/* nosourcemap */